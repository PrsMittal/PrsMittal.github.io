(()=>{const e=window;e.Groups={NEARME_LIMIT:5,events:[],showNearMeErrorMessage:()=>{const r=$$(".meetup-group[data-country='Near me']")[0];if(!r.hasClass("error")){r.addClass("error");const t=document.importNode(document.getElementById("nearme-error").content,!0);r.appendChild(t);const o=$$("#icon-arrow")[0];let s,a=0;e.addEventListener("mousemove",r=>{const t=o.getBoundingClientRect(),n=(r.clientX-t.x-24)/2,u=(r.clientY-t.y-24)/2;s&&n<0&&u>0&&s<=0?a-=1:s&&n<0&&u<=0&&s>0&&(a+=1),s=u;let i=0;n>=0&&u<0?i=90+180*Math.atan(u/n)/Math.PI:n>=0&&u>=0?i=90+180*Math.atan(u/n)/Math.PI:n<0&&u>=0?i=270+180*Math.atan(u/n)/Math.PI:n<0&&u<0&&(i=180*Math.atan(u/n)/Math.PI-90),e.Groups.arrowDeg=360*a+i}),e.requestAnimationFrame(e.Groups.animateArrow)}},arrowDeg:0,arrowDegTemp:0,arrowActDeg:0,animateArrow:()=>{e.requestAnimationFrame(e.Groups.animateArrow);const r=$$("#icon-arrow .arrow")[0];e.Groups.arrowActDeg=.85*e.Groups.arrowActDeg+.05*(e.Groups.arrowDeg-e.Groups.arrowDegTemp),e.Groups.arrowDegTemp+=e.Groups.arrowActDeg,r.style.transform="rotate("+e.Groups.arrowDegTemp+"deg)"},getNearMeEvents:r=>{$$.ajax({type:"POST",url:"https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyBpw224S0Crv7R7h88qY_lxfRiILvi-_8s",success:t=>{const o=JSON.parse(t);o.accuracy/1e3<200?e.Groups.renderNearMe(o.location.lat,o.location.lng):e.Groups.showNearMeErrorMessage(),$$(".country-filter")[0].value="Near me",r.addClass("loaded"),e.Groups.resizeSection()},error:()=>{e.Groups.showNearMeErrorMessage()}})},showGroup:(r,t)=>{const o=$$('.meetup-group[data-country="'+r+'"]')[0];$$(".meetup-group.show").removeClass("show"),o.addClass("show"),e.Groups.resizeSection();const s=document.querySelector(".section-groups .select-container");let a="none";"Near me"==r?(s.classList.add("hide-flag"),o.classList.contains("loaded")?(e.Groups.renderEvents(o.find("li")),o.addClass("show"),e.Groups.resizeSection()):e.Groups.getNearMeEvents(o,t)):"Show all"==r?(s.classList.add("hide-flag"),e.Groups.renderEvents(o.find("li")),o.addClass("show"),e.Groups.resizeSection()):(s.classList.remove("hide-flag"),a="url(/images/pages/community/flags/"+r.toLowerCase().replace(" ","_")+".png)",e.Groups.renderEvents(o.find("li")),o.addClass("show"),e.Groups.resizeSection()),s.style.setProperty("--country-flag",a)},sortGroupsbyLocation:(e,r)=>{const t=[];return $$('.meetup-group[data-country="Show all"] .meetup').each((o,s)=>{t.push({node:s,lat:s.getAttribute("data-lat"),lng:s.getAttribute("data-lng"),distance:Math.round(Sketch.funcs.calculateDistance(s.getAttribute("data-lat"),s.getAttribute("data-lng"),e,r))})}),t.sort((e,r)=>e.distance>r.distance?1:-1)},renderNearMe:(r,t)=>{const o=$$(".meetup-group[data-country='Near me']")[0],s=e.Groups.sortGroupsbyLocation(r,t);for(let r=0;r<=e.Groups.NEARME_LIMIT;r++){const e=s[r].node.cloneNode(!0);o.appendChild(e)}e.Groups.renderEvents(o.find("li"))},renderEvents:r=>{const t=(new Date).getTime();Array.from(r).forEach(r=>{const o=e.Groups.events.filter(e=>e.utc_time>=t&&e.group_url==r.find("a")[0].getAttribute("href")),s=r.find(".card-event-counter")[0];o.length>0?(s.textContent=o.length+" upcoming event"+(o.length>1?"s":""),s.addClass("show")):s.removeClass("show")})},resizeSection:()=>{const e=$$(".section-groups")[0],r=$$(".meetup-group.show")[0];setTimeout(()=>{e.style.height=$$(".section-groups .groups-wrapper")[0].offsetTop+r.offsetHeight+"px"},100)},loadData:()=>{$$.ajax({type:"GET",url:"/community/group-events.json",success:r=>{e.Groups.events=r.events,e.Groups.init()},error:()=>{}})},init:()=>{const r=$$(".country-filter")[0];r.addEventListener("change",()=>{e.Groups.showGroup(r.value,!0)}),e.Groups.showGroup("Near me"),r.value="Near me",window.addEventListener("resize",e.Groups.resizeSection)}},$$.ready(()=>{e.Groups.loadData()})})();